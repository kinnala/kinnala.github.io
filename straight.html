<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-10-07 Mon 00:02 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Getting started with straight.el</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="T. Gustafsson. Theme: Copyright (c) 2019 [[https://github.com/gongzhitaao/orgcss][gongzhitaao]]gongzhitaao." />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://kinnala.github.io/org.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Getting started with straight.el</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org693f83f">1. Introduction</a></li>
<li><a href="#org79cd83d">2. Find a list of packages</a></li>
<li><a href="#org4db7a3e">3. Bootstrapping the config</a></li>
<li><a href="#orgfef06ab">4. Installing packages</a></li>
<li><a href="#org7bbd184">5. Installing <code>use-package</code></a></li>
<li><a href="#orgc12404b">6. Installing <code>ivy</code></a></li>
<li><a href="#org5f871a6">7. Recipes</a></li>
<li><a href="#orgb0dd3b0">8. A peak under the hood</a></li>
</ul>
</div>
</div>

<div id="outline-container-org693f83f" class="outline-2">
<h2 id="org693f83f"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
There exists a functional package manager for Emacs called straight.el.  It
is notorious for its complexity but I find it convenient since using Emacs
on multiple machines and keeping the config in sync can be otherwise tedious.
</p>

<p>
This post describes my setup and contains hints on using straight.el. Since I'm
using Dropbox to sync my dotfiles, I have a single init file
<code>~/Dropbox/Config/emacs/.emacs</code> which is symlinked to my home directory via <code>ln
-s ~/Dropbox/Config/emacs/.emacs ~/.emacs</code>.
</p>
</div>
</div>

<div id="outline-container-org79cd83d" class="outline-2">
<h2 id="org79cd83d"><span class="section-number-2">2</span> Find a list of packages</h2>
<div class="outline-text-2" id="text-2">
<p>
We are going to create a new <code>.emacs</code> from scratch. First you need a list of
packages to install. By default, straight.el supports MELPA, ELPA and
Emacsmirror, but you can easily fetch packages from Github and GitLab.  Any
existing <code>use-package</code> macros can be reused.
</p>

<p>
Suppose we want to have the following packages:
</p>
<ul class="org-ul">
<li><code>org</code></li>
<li><code>ivy</code></li>
<li><code>counsel</code></li>
<li><code>swiper</code></li>
<li><code>anzu</code></li>
</ul>
</div>
</div>

<div id="outline-container-org4db7a3e" class="outline-2">
<h2 id="org4db7a3e"><span class="section-number-2">3</span> Bootstrapping the config</h2>
<div class="outline-text-2" id="text-3">
<p>
The first lines of the config are magic.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">bootstrap-version</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">let</span> <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span>bootstrap-file
       <span style="color: #709870;">(</span>expand-file-name
        <span style="color: #008000;">"straight/repos/straight.el/bootstrap.el"</span>
        user-emacs-directory<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
      <span style="color: #909183;">(</span>bootstrap-version 5<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">unless</span> <span style="color: #909183;">(</span>file-exists-p bootstrap-file<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #0000FF;">with-current-buffer</span>
        <span style="color: #709870;">(</span>url-retrieve-synchronously
         <span style="color: #008000;">"https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"</span>
         'silent 'inhibit-cookies<span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>goto-char <span style="color: #907373;">(</span>point-max<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>eval-print-last-sexp<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>load bootstrap-file nil 'nomessage<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
On Emacs startup, this will download straight.el install script from Github and
run it - but only if straight.el is not already installed.
</p>
</div>
</div>

<div id="outline-container-orgfef06ab" class="outline-2">
<h2 id="orgfef06ab"><span class="section-number-2">4</span> Installing packages</h2>
<div class="outline-text-2" id="text-4">
<p>
After running Emacs, you can install packages via <code>M-x straight-use-package</code>.
This installs and enables the package only within the current session and it
will be gone after you restart Emacs. It's great for trying out new packages!
</p>

<p>
To permanently install a package, include the following line in your <code>.emacs</code>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>straight-use-package 'org<span style="color: #707183;">)</span>
</pre>
</div>

<p>
This installs the newest version of <code>org-mode</code> directly from its repository at
<code>code.orgmode.org</code>.
</p>

<p>
<b><b>You are advised to install <code>org</code> first so that the built-in version is not
accidentally activated.</b></b>
</p>
</div>
</div>

<div id="outline-container-org7bbd184" class="outline-2">
<h2 id="org7bbd184"><span class="section-number-2">5</span> Installing <code>use-package</code></h2>
<div class="outline-text-2" id="text-5">
<p>
The macro <code>use-package</code> is popular for keeping all package configuration in one
place. Adding the following lines to <code>.emacs</code> will install and enable it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>straight-use-package 'use-package<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> straight-use-package-by-default t<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc12404b" class="outline-2">
<h2 id="orgc12404b"><span class="section-number-2">6</span> Installing <code>ivy</code></h2>
<div class="outline-text-2" id="text-6">
<p>
Now we can write <code>use-package</code> macros to install and configure packages:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">use-package</span> <span style="color: #D0372D;">ivy</span>
  <span style="color: #006FE0;">:init</span>
  <span style="color: #7388D6;">(</span>ivy-mode 1<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">setq</span> ivy-height 12
        ivy-fixed-height-minibuffer t
        ivy-use-virtual-buffers t<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">:bind</span> <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"C-x b"</span> . ivy-switch-buffer<span style="color: #909183;">)</span>
         <span style="color: #909183;">(</span><span style="color: #008000;">"C-c r"</span> . ivy-resume<span style="color: #909183;">)</span>
         <span style="color: #909183;">(</span><span style="color: #008000;">"C-x C-b"</span> . ivy-switch-buffer<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">use-package</span> <span style="color: #D0372D;">counsel</span>
  <span style="color: #006FE0;">:bind</span> <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"M-x"</span> . counsel-M-x<span style="color: #909183;">)</span>
         <span style="color: #909183;">(</span><span style="color: #008000;">"C-x C-f"</span> . counsel-find-file<span style="color: #909183;">)</span>
         <span style="color: #909183;">(</span><span style="color: #008000;">"C-c g"</span> . counsel-ag<span style="color: #909183;">)</span>
         <span style="color: #909183;">(</span><span style="color: #008000;">"C-c G"</span> . counsel-git<span style="color: #909183;">)</span>
         <span style="color: #909183;">(</span><span style="color: #008000;">"M-y"</span> . counsel-yank-pop<span style="color: #909183;">)</span>
         <span style="color: #909183;">(</span><span style="color: #008000;">"C-c C-j"</span> . counsel-imenu<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">use-package</span> <span style="color: #D0372D;">swiper</span>
  <span style="color: #006FE0;">:bind</span> <span style="color: #7388D6;">(</span><span style="color: #008000;">"C-c s"</span> . swiper<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f871a6" class="outline-2">
<h2 id="org5f871a6"><span class="section-number-2">7</span> Recipes</h2>
<div class="outline-text-2" id="text-7">
<p>
You can easily define a new recipe if the package cannot be
found in any of the supported repositories:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">use-package</span> <span style="color: #D0372D;">anzu</span>
  <span style="color: #006FE0;">:straight</span> <span style="color: #7388D6;">(</span>anzu
             <span style="color: #006FE0;">:type</span> git
             <span style="color: #006FE0;">:host</span> github
             <span style="color: #006FE0;">:repo</span> <span style="color: #008000;">"syohex/emacs-anzu"</span><span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">:init</span> <span style="color: #7388D6;">(</span>global-anzu-mode +1<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">:bind</span> <span style="color: #7388D6;">(</span><span style="color: #008000;">"C-q"</span> . anzu-query-replace-regexp<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
This installs <code>anzu</code> from <code>github.com/syohex/emacs-anzu</code>.
</p>
</div>
</div>

<div id="outline-container-orgb0dd3b0" class="outline-2">
<h2 id="orgb0dd3b0"><span class="section-number-2">8</span> A peak under the hood</h2>
<div class="outline-text-2" id="text-8">
<p>
In <code>~/.emacs.d/straight</code> you find two directories: <code>repos</code> and <code>build</code>.  The
former contains all cloned git repositories of the installed packages.  If you
list its contents you notice that there are also some additional packages - the
dependencies of the ones that we explicitly installed. I like to add these to my
config but it's not required.
</p>

<p>
The latter directory contains bytecompiled versions of the package source code
files.  This is populated automatically by straight.el but once or twice I've
had to interfere with its contents as straight.el does not yet support custom
build steps (such as running <code>make</code>) during the installation of packages. For
example, <code>zmq</code> (which is a dependency of <code>jupyter</code>) I could only install by
first adding
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>straight-use-package
 '<span style="color: #7388D6;">(</span>zmq <span style="color: #006FE0;">:type</span> git <span style="color: #006FE0;">:host</span> github <span style="color: #006FE0;">:repo</span> <span style="color: #008000;">"dzop/emacs-zmq"</span> <span style="color: #006FE0;">:no-build</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
and then launching Emacs. This clones <code>zmq</code> to
<code>~/.emacs.d/straight/repos/emacs-zmq</code> but does not build it. Then I'd go to the
package's directory, run <code>make</code> and create a symlink
<code>~/.emacs.d/straight/build/zmq</code> which points to
<code>~/.emacs.d/straight/repos/emacs-zmq</code>.  Finally, I'd remove <code>:no-build</code> and
restart Emacs.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: T. Gustafsson. Theme: Copyright (c) 2019 <a href="https://github.com/gongzhitaao/orgcss">gongzhitaao</a>.</p>
<p class="date">Created: 2019-10-07 Mon 00:02</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
